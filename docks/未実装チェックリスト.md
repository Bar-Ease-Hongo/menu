# 未実装チェックリスト（2025-10 現在）

運用・開発上の優先度を付けやすくするため、現状の未実装／要対応タスクを整理したチェックリストです。作業着手時は該当項目にリンクされているソース・ドキュメントも合わせて確認してください。

---

## ✅=完了, ☐=未完了

### Webhook / メニュー更新まわり
- ✅ DynamoDB への書き戻し実装
  - 画像コピー後に `imageUrl` を `publicKey` で更新
  - `aiSuggestedDescription` を `description` に昇格（必要なら差分確認）
  - `aiStatus` を `Approved` に更新、履歴管理方針の決定
  - 対象コード: `services/lambda/menu/src/index.ts:220`
- ☐ CloudFront 無効化フローの実装
  - `menu.json` 更新後に `/menu.json` を Invalidate（環境変数で ON/OFF 切替検討）
  - SDK 追加と IAM 許可の調整（CloudFront）
  - ドキュメント: `docks/承認.md:115`
- ☐ Webhook リプレイ防止強化
  - `timestamp` だけでなく nonce（使い捨てトークン）を導入し、DynamoDB などに保存
  - 失効期間と TTL 設計
  - ドキュメント: `docks/承認.md:148`

### AI 補完・夜間バッチ
- ☐ `nightlyCompletionHandler` の DynamoDB 書き戻し
  - Claude 生成結果を `aiSuggested*` 列へ反映する Update 処理
  - エラー・再試行の設計（Powertools など導入検討）
  - 関連 TODO: `services/lambda/menu/src/index.ts:220`、`README.md:62`
- ☐ AI 補完対象列の最終確定フロー設計
  - どの列を AI 自動確定に任せるか／人のレビューを必須にするか
  - 設計書反映: `docks/仕様書.md`

### Embedding / レコメンド系
- ☐ `embeddings.json` 生成・更新ジョブ
  - メニュー更新時に埋め込みを再作成し S3 へ格納
  - Bedrock Titan 呼び出しのバッチ／Lambda 設計
  - `services/lambda/recommend/src/index.ts` との整合
- ☐ makers.json 生成パイプライン
  - DynamoDB からメーカー一覧を作成し S3 へ出力
  - フロントの `fetchMakers` フォールバック依存を解消
- ☐ Next.js `/api/recommend` のリプレイス
  - ローカル用の簡易実装を本番 API（AWS Lambda）に向ける
  - エラーハンドラとローディング UI 再検討

### データ同期・整合性
- ✅ Google Sheet → DynamoDB 同期方式の確定
  - GAS onEdit + 時間トリガーから `/sync/menu` を呼び出し、Upsert/Delete を実装
  - `gas/onEdit.gs` と `docks/承認.md:121` を参照
- ☐ `status` / `approveFlag` の編集権限と監査ログ
  - 誰がいつ変更したかを記録する仕組み（AppFlow EventBridge など）
- ☐ `menu.json` + `embeddings.json` の一貫性保証
  - 再生成の順序管理（トランザクション／バージョン付け）

### DevOps / 運用
- ☐ CloudWatch Metrics & Alarm 整備
  - Webhook 失敗回数、S3 Copy 失敗、Dynamo Update 失敗、レコメンド遅延など
- ☐ CI/CD パイプライン
  - Unit/E2E テスト、自動デプロイ（GitHub Actions or SST Pipeline）
- ☐ Secrets / Parameter 管理
  - `GAS_WEBHOOK_SECRET` 以外のシークレット整理（Bedrock モデル ID など）

### フロントエンド
- ☐ `menu.json` 404 時のユーザー通知改善
  - 現状は静的 fallback だが、運用時の警告 UI を検討
- ☐ 画像表示のプレースホルダと読み込み失敗時の処理
  - `Image` コンポーネントの `onError` ハンドリング
- ☐ QR コード生成（仕様書要件）
  - `/menu?maker=` 用の静的・動的 QR 対応

---

## メモ
- 本チェックリストは「未実装/未整備項目」を追跡するためのドラフトです。対応が完了した項目は適宜 ✅ に変更し、ドキュメント内のリンク先も更新してください。
- 追加で発生した課題はこのファイルに追記するか、課題管理ツール（Jira/Linear など）にも連携する運用を想定しています。
